# yaml-language-server: $schema=https://raw.githubusercontent.com/helm-unittest/helm-unittest/main/schema/helm-testsuite.json
suite: Test for gateway-hpa
templates:
  - gateway/gateway-hpa.yaml
tests:
  - it: Gateway collector's HPA spec should match snapshot when using default values on cluster with Metrics Server
    template: gateway/gateway-hpa.yaml
    capabilities:
      apiVersions:
        - metrics.k8s.io/v1beta1
    asserts:
      - matchSnapshot:
          path: spec
  - it: Gateway collector's HPA should not be generated when using default values on cluster without Metrics Server
    template: gateway/gateway-hpa.yaml
    asserts:
      - hasDocuments:
          count: 0
  - it: Gateway collector's HPA should not be generated when the Gateway collector is disabled
    template: gateway/gateway-hpa.yaml
    capabilities:
      apiVersions:
        - metrics.k8s.io/v1beta1
    set:
      otel.gateway.enabled: false
    asserts:
      - hasDocuments:
          count: 0
